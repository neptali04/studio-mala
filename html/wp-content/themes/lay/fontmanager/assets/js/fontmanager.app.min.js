!function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:o})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);var o={showModal:function(){i()}},i=function(){var t=wp.media({title:"Upload Font",library:{type:["application/font-woff","application/x-font-ttf","font/woff2","application/font-woff2","application/x-font-woff2"]},button:{text:"Ok"},multiple:!1});t.on("open",function(){"upload"!=t.content._mode&&t.content.mode("upload")}),t.on("select",function(){var e=t.state().get("selection").toJSON(),n=e[0].filename.charAt(0);jQuery.isNumeric(n)?window.alert("Error: Please make sure your filename does not start with a number."):R.insertFontRowByAttachment(e[0])}),t.open()},a={hideModal:function(){d()},bindModalEvents:function(){l()}},l=function(){jQuery("#add-webfont-input-modal .close-modal-btn").on("click",function(){d()}),jQuery("#add-webfont-input-modal .background").on("click",function(){d()}),jQuery(document).keyup(function(t){27==t.keyCode&&d()})},d=function(){jQuery("#add-webfont-input-modal").hide(),jQuery("#add-webfont-input-modal .webfont-type-choice-wrap").show(),jQuery("#add-webfont-input-modal .lay-webfont-form").hide(),jQuery("#add-webfont-input-modal .js-ok-button").hide().attr("disabled","disabled"),jQuery(".js-link-font-name-input").removeAttr("disabled").val("").parsley().validate(),jQuery(".js-link-tag-input").val("").parsley().validate(),jQuery(".js-link-font-family-input").val("").parsley().validate(),jQuery(".js-js-font-name-input").removeAttr("disabled").val("").parsley().validate(),jQuery(".js-js-embed-code").val("").parsley().validate(),jQuery(".js-js-font-family-input").val("").parsley().validate(),jQuery("#add-webfont-input-modal").removeClass("edit-mode")},r=Marionette.View.extend({template:"#row-view",initialize:function(){this.model.on("change",this.render,this)},className:"row-wrap",tagName:"tr",templateContext:function(){var t=this.model;return{showFontName:function(){if(t.get("fontname"))return t.get("fontname")},showFontCSS:function(){var e=t.get("type");return"link"==e||"script"==e?'style="'+t.get("css")+'"':'style="font-family:'+t.get("fontname")+';"'},showText:function(){if(t.get("fontname"))return"The quick brown fox jumps over the lazy dog."},showType:function(){var e=t.get("type");return e||"attachment"},showTypeDetailed:function(){var e=t.get("type");if(e){var n=t.get("filetype");return void 0===n&&(n="woff"),"attachment"==e?e+"/"+n:e}return"attachment"}}},events:{"click .js-delete-row":"deleteRow","click .js-edit-row":"showEditFontRowModal"},deleteRow:function(t){t.preventDefault(),R.deleteFontRow(this.model)},showEditFontRowModal:function(t){t.preventDefault(),R.showEditFontRowModal(this.model)}}),s=Marionette.CompositeView.extend({tagName:"div",template:"#row-composite-view",childViewContainer:".rows",childView:r,events:{"click .js-add-font":"showAddFontModal","click .js-upload-woff-btn":"showUploader","click .js-link-css-btn":"showLinkCSSModal","click .js-js-css-btn":"showJSCSSModal"},showAddFontModal:function(t){t.preventDefault(),jQuery("#add-webfont-input-modal").show()},showUploader:function(t){t.preventDefault(),o.showModal(),a.hideModal()},showLinkCSSModal:function(){jQuery("#add-webfont-input-modal .webfont-type-choice-wrap").hide(),jQuery("#add-webfont-input-modal .link-css-modal").show(),jQuery(".js-add-link-font-btn").show()},showJSCSSModal:function(){jQuery("#add-webfont-input-modal .webfont-type-choice-wrap").hide(),jQuery("#add-webfont-input-modal .js-css-modal").show(),jQuery(".js-add-js-font-btn").show()}}),u={validFontName:!1,validLinkTag:!1,validFontFamily:!1},c={$name:null,$tag:null,$family:null},f={initModule:function(){p(),j(),b(),y(),m()},setAllInputsToValid:function(){w()}},p=function(){c.$name=jQuery(".js-link-font-name-input"),c.$tag=jQuery(".js-link-tag-input"),c.$family=jQuery(".js-link-font-family-input")},y=function(){c.$name.on("keyup",function(){u.validFontName=jQuery(this).parsley().validate(),v()}),c.$tag.on("keyup",function(){u.validLinkTag=jQuery(this).parsley().validate(),v()}),c.$family.on("keyup",function(){u.validFontFamily=jQuery(this).parsley().validate(),v()})},w=function(){u.validFontName=!0,u.validLinkTag=!0,u.validFontFamily=!0},m=function(){jQuery("#add-webfont-input-modal input").each(function(){jQuery(this).popover({animation:!1,trigger:"manual",container:"body",placement:"bottom",content:""})})},j=function(){window.ParsleyValidator.addValidator("nonumberasfirstchar",function(t,e){var n=!0,o=t.substr(0,1);return 0!=o&&1!=o&&2!=o&&3!=o&&4!=o&&5!=o&&6!=o&&7!=o&&8!=o&&9!=o||(n=!1),n},32).addMessage("en","nonumberasfirstchar","Please don't use a number as a first character"),window.ParsleyValidator.addValidator("linktag",function(t,e){var n=!1,o=t.substr(t.length-1);return"<link"==t.substr(0,5)&&">"==o&&(n=!0),n},32).addMessage("en","linktag",'A valid "link" tag begins with "<link" and ends with ">"'),window.ParsleyValidator.addValidator("fontfamily",function(t,e){var n=!1,o=t.substr(t.length-1);return"font-family:"==t.substr(0,12)&&";"==o&&(n=!0),(t.match(/:/g)||[]).length>1&&(n=!1),n},32).addMessage("en","fontfamily",'A valid "font-family" CSS style begins with "font-family:" and ends with ";"'),window.Parsley.on("field:error",function(){var t=this.getErrorsMessages();this.$element.data("bs.popover").options.content=t.join(";"),this.$element.popover("show")}),window.Parsley.on("field:success",function(){this.$element.popover("hide")})},v=function(){1==u.validFontName&&1==u.validLinkTag&&1==u.validFontFamily?jQuery(".js-add-link-font-btn").removeAttr("disabled"):jQuery(".js-add-link-font-btn").attr("disabled","disabled")},b=function(){jQuery("#add-webfont-input-modal .js-add-link-font-btn").on("click",function(t){t.preventDefault();var e=jQuery(".js-link-font-family-input").val(),n=jQuery(".js-link-tag-input").val(),o=jQuery(".js-link-font-name-input").val();jQuery("#add-webfont-input-modal").hasClass("edit-mode")?R.editFontRowByLinkAndCSS(o,n,e):R.insertFontRowByLinkAndCSS(o,n,e),a.hideModal()})},h={validFontName:!1,validJSEmbedCode:!1,validFontFamily:!1},g={$name:null,$code:null,$family:null},Q={initModule:function(){k(),M(),N(),V(),F()},setAllInputsToValid:function(){S()}},k=function(){g.$name=jQuery(".js-js-font-name-input"),g.$code=jQuery(".js-js-embed-code"),g.$family=jQuery(".js-js-font-family-input")},S=function(){h.validFontName=!0,h.validJSEmbedCode=!0,h.validFontFamily=!0},F=function(){jQuery("#add-webfont-input-modal input").each(function(){jQuery(this).popover({animation:!1,trigger:"manual",container:"body",placement:"bottom",content:""})})},M=function(){window.Parsley.addValidator("scripttag",function(t,e){var n=!1,o=t.substr(t.length-1);return"<script"==t.substr(0,7)&&">"==o&&(n=!0),n},32).addMessage("en","scripttag",'Valid "script" tags begin with "<script" and end with ">"'),window.Parsley.on("field:error",function(){var t=this.getErrorsMessages();this.$element.data("bs.popover").options.content=t.join(";"),this.$element.popover("show")}),window.Parsley.on("field:success",function(){this.$element.popover("hide")})},V=function(){jQuery(".js-js-font-name-input").on("keyup",function(){h.validFontName=jQuery(this).parsley().validate(),C()}),jQuery(".js-js-embed-code").on("keyup",function(){h.validJSEmbedCode=jQuery(this).parsley().validate(),C()}),jQuery(".js-js-font-family-input").on("keyup",function(){h.validFontFamily=jQuery(this).parsley().validate(),C()})},C=function(){1==h.validJSEmbedCode&&1==h.validFontName&&1==h.validFontFamily?jQuery(".js-add-js-font-btn").removeAttr("disabled"):jQuery(".js-add-js-font-btn").attr("disabled","disabled")},N=function(){jQuery("#add-webfont-input-modal .js-add-js-font-btn").on("click",function(t){t.preventDefault();var e=jQuery(".js-js-embed-code").val(),n=jQuery(".js-js-font-name-input").val(),o=jQuery(".js-js-font-family-input").val();jQuery("#add-webfont-input-modal").hasClass("edit-mode")?R.editFontRowByScriptAndCSS(n,e,o):R.insertFontRowByScriptAndCSS(n,e,o),a.hideModal()})},O={rowsView:null},R={initRows:function(t){T(t)},getRowsView:function(){return O.rowsView},insertFontRowByAttachment:function(t){J(t)},insertFontRowByLinkAndCSS:function(t,e,n){$(t,e,n)},insertFontRowByScriptAndCSS:function(t,e,n){A(t,e,n)},deleteFontRow:function(t){x(t)},showEditFontRowModal:function(t){P(t)},editFontRowByLinkAndCSS:function(t,e,n){E(t,e,n)},editFontRowByScriptAndCSS:function(t,e,n){B(t,e,n)}},A=function(t,e,n){jQuery("head").append(e);n=n.replace(/"/g,"'");var o=new Backbone.Model({fontname:t,script:e,css:n,type:"script"});O.rowsView.collection.add(o),_.updateJSON()},$=function(t,e,n){jQuery("head").prepend(e);n=n.replace(/"/g,"'");var o=new Backbone.Model({fontname:t,link:e,css:n,type:"link"});O.rowsView.collection.add(o),_.updateJSON()},J=function(t){var e="";switch(console.log(t.mime),t.mime){case"application/x-font-ttf":e="truetype";break;case"application/font-woff":e="woff";break;case"font/woff2":case"application/font-woff2":case"application/x-font-woff2":e="woff2"}var n='<style>@font-face{ font-family: "'+t.title+'"; src: url("'+t.url+'") format("'+e+'"); }</style>';jQuery("head").append(n);var o=new Backbone.Model({fontname:t.title,url:t.url,id:t.id,type:"attachment",filetype:e});O.rowsView.collection.add(o),_.updateJSON()},x=function(t){O.rowsView.collection.remove(t),_.updateJSON()},E=function(t,e,n){var o=O.rowsView.collection.where({fontname:t})[0];jQuery("head").append(e);n=n.replace(/"/g,"'");o.set("link",e),o.set("css",n),_.updateJSON()},B=function(t,e,n){var o=O.rowsView.collection.where({fontname:t})[0];jQuery("head").append(e);n=n.replace(/"/g,"'");o.set("script",e),o.set("css",n),_.updateJSON()},P=function(t){switch(t.get("type")){case"link":jQuery("#add-webfont-input-modal").addClass("edit-mode"),jQuery(".js-add-font").click(),jQuery(".js-link-css-btn").click(),jQuery(".js-link-font-name-input").val(t.get("fontname")).attr("disabled","disabled"),jQuery(".js-link-tag-input").val(t.get("link")).parsley().validate(),jQuery(".js-link-font-family-input").val(t.get("css")).parsley().validate(),f.setAllInputsToValid();break;case"script":jQuery("#add-webfont-input-modal").addClass("edit-mode"),jQuery(".js-add-font").click(),jQuery(".js-js-css-btn").click(),jQuery(".js-js-font-name-input").val(t.get("fontname")).attr("disabled","disabled"),jQuery(".js-js-embed-code").val(t.get("script")).parsley().validate(),jQuery(".js-js-font-family-input").val(t.get("css")).parsley().validate(),Q.setAllInputsToValid()}},T=function(t){O.rowsView=new s({collection:t}),L()},L=function(){},D={jsonObject:null},_={getRowsEntities:function(){return I()},updateJSON:function(){z()},getJSON:function(){U()},getJSONObject:function(){return D.jsonObject}},I=function(){var t=[];return null!=D.jsonObject&&(t=D.jsonObject),new Backbone.Collection(t)},U=function(){var t=jQuery.trim(jQuery("#fontmanager_json").val());if(void 0!==t&&""!=t){var e=JSON.parse(t);D.jsonObject=e}},z=function(){var t=R.getRowsView().collection.toJSON(),e=window.JSON.stringify(t,void 0,2);jQuery("#fontmanager_json").val(e)};(new(Marionette.Application.extend({region:"#fontmanager",onStart:function(){_.getJSON();var t=_.getRowsEntities();R.initRows(t);var e=R.getRowsView();this.showView(e),f.initModule(),Q.initModule(),a.bindModalEvents(),jQuery('[data-toggle="tooltip"]').tooltip({container:".webfont-type-choice-wrap"})}}))).start()}]);